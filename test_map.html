<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Test - Bus Tracking System</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #2563eb;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .status {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        #map {
            width: 100%;
            height: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .controls {
            margin-top: 20px;
            text-align: center;
        }
        
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 0 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #1d4ed8;
        }
        
        .links {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .links a {
            display: inline-block;
            margin: 5px 10px;
            padding: 8px 16px;
            background: #10b981;
            color: white;
            text-decoration: none;
            border-radius: 6px;
        }
        
        .links a:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è Map Test Page</h1>
        
        <div class="status">
            <strong>Status:</strong> <span id="status">Loading...</span><br>
            <strong>Leaflet:</strong> <span id="leaflet-status">Checking...</span><br>
            <strong>Map:</strong> <span id="map-status">Initializing...</span>
        </div>
        
        <div id="map"></div>
        
        <div class="controls">
            <button onclick="addTestMarker()">Add Test Bus</button>
            <button onclick="centerMap()">Center Map</button>
            <button onclick="toggleLayer()">Toggle Satellite</button>
        </div>
        
        <div class="links">
            <strong>Navigation:</strong>
            <a href="login.html">üîê Login Page</a>
            <a href="index_leaflet.html">üó∫Ô∏è Main App</a>
            <a href="test_data_generator.html">üß™ Test Generator</a>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <script>
        let map;
        let streetLayer;
        let satelliteLayer;
        let currentLayer = 'street';
        let testMarkers = [];
        
        // Update status
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            console.log('Status:', message);
        }
        
        // Check if Leaflet loaded
        function checkLeaflet() {
            if (typeof L !== 'undefined') {
                document.getElementById('leaflet-status').textContent = '‚úÖ Loaded';
                document.getElementById('leaflet-status').style.color = 'green';
                return true;
            } else {
                document.getElementById('leaflet-status').textContent = '‚ùå Failed to load';
                document.getElementById('leaflet-status').style.color = 'red';
                return false;
            }
        }
        
        // Initialize map
        function initMap() {
            try {
                updateStatus('Initializing map...');
                
                // Check Leaflet
                if (!checkLeaflet()) {
                    throw new Error('Leaflet not loaded');
                }
                
                // Create map
                map = L.map('map').setView([17.6712, 75.3234], 13);
                
                // Street layer
                streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);
                
                // Satellite layer
                satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    maxZoom: 19,
                    attribution: '¬© Esri, Maxar, Earthstar Geographics'
                });
                
                // Add initial marker
                const marker = L.marker([17.6712, 75.3234]).addTo(map);
                marker.bindPopup('üöå Test Bus Location<br>Map is working correctly!').openPopup();
                
                document.getElementById('map-status').textContent = '‚úÖ Map loaded successfully';
                document.getElementById('map-status').style.color = 'green';
                updateStatus('‚úÖ Map ready! All systems working.');
                
            } catch (error) {
                console.error('Map initialization error:', error);
                document.getElementById('map-status').textContent = '‚ùå Failed: ' + error.message;
                document.getElementById('map-status').style.color = 'red';
                updateStatus('‚ùå Map failed to load: ' + error.message);
            }
        }
        
        // Add test marker
        function addTestMarker() {
            if (!map) {
                alert('Map not initialized');
                return;
            }
            
            const lat = 17.6712 + (Math.random() - 0.5) * 0.02;
            const lng = 75.3234 + (Math.random() - 0.5) * 0.02;
            
            const marker = L.marker([lat, lng]).addTo(map);
            marker.bindPopup(`üöå Test Bus #${testMarkers.length + 1}<br>Lat: ${lat.toFixed(4)}<br>Lng: ${lng.toFixed(4)}`);
            
            testMarkers.push(marker);
            updateStatus(`Added test marker #${testMarkers.length}`);
        }
        
        // Center map
        function centerMap() {
            if (!map) return;
            map.setView([17.6712, 75.3234], 13);
            updateStatus('Map centered');
        }
        
        // Toggle layer
        function toggleLayer() {
            if (!map) return;
            
            if (currentLayer === 'street') {
                map.removeLayer(streetLayer);
                map.addLayer(satelliteLayer);
                currentLayer = 'satellite';
                updateStatus('Switched to satellite view');
            } else {
                map.removeLayer(satelliteLayer);
                map.addLayer(streetLayer);
                currentLayer = 'street';
                updateStatus('Switched to street view');
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('Page loaded, checking components...');
            
            // Wait a bit for Leaflet to load
            setTimeout(() => {
                initMap();
            }, 500);
        });
        
        // Handle errors
        window.addEventListener('error', function(e) {
            console.error('Page error:', e.error);
            updateStatus('‚ùå Error: ' + e.error.message);
        });
    </script>
</body>
</html>
